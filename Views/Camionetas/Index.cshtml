@model IEnumerable<SistemaMantencion.Models.Camioneta>

@{
    ViewData["Title"] = "Camionetas";
    var mostrarEliminadas = ViewBag.MostrarEliminadas ?? false;
}

<h1>ğŸš™ Flota de Camionetas</h1>

<div class="mb-3">
    <a asp-action="Create" class="btn btn-primary">â• Agregar Camioneta</a>
    <a asp-action="Index" class="btn btn-secondary">Todas</a>
    <a asp-action="Index" asp-route-estadoFiltro="Disponible" class="btn btn-success">Disponibles</a>
    <a asp-action="Index" asp-route-estadoFiltro="EnArriendo" class="btn btn-warning">En Arriendo</a>
    <a asp-action="Index" asp-route-estadoFiltro="EnMantencion" class="btn btn-danger">En MantenciÃ³n</a>
    
    @if (!mostrarEliminadas)
    {
        <a asp-action="Index" asp-route-mostrarEliminadas="true" class="btn btn-outline-secondary">
            ğŸ‘ï¸ Ver Eliminadas
        </a>
    }
    else
    {
        <a asp-action="Index" class="btn btn-outline-primary">
            ğŸ‘ï¸ Ver Solo Activas
        </a>
    }
</div>

@if (mostrarEliminadas)
{
    <div class="alert alert-info">
        <strong>â„¹ï¸ Mostrando camionetas eliminadas.</strong> Estas camionetas estÃ¡n ocultas pero pueden ser restauradas.
    </div>
}

<table class="table table-striped table-hover">
    <thead class="table-dark">
        <tr>
            <th>Estado Registro</th>
            <th>Patente</th>
            <th>Marca/Modelo</th>
            <th>AÃ±o</th>
            <th>Kilometraje</th>
            <th>Estado</th>
            <th>Ãšltima MantenciÃ³n</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr class="@(!item.Activo ? "table-secondary" : "")">
                <td>
                    @if (item.Activo)
                    {
                        <span class="badge bg-success">Activa</span>
                    }
                    else
                    {
                        <span class="badge bg-danger">Eliminada</span>
                        <br/>
                        <small class="text-muted">@item.FechaEliminacion?.ToString("dd/MM/yyyy")</small>
                    }
                </td>
                <td><strong>@item.Patente</strong></td>
                <td>@item.Marca @item.Modelo</td>
                <td>@item.Anio</td>
                <td>@item.Kilometraje.ToString("N0") km</td>
                <td>
                    @if (item.Estado == "Disponible")
                    {
                        <span class="badge bg-success">@item.Estado</span>
                    }
                    else if (item.Estado == "EnArriendo")
                    {
                        <span class="badge bg-warning">En Arriendo</span>
                    }
                    else
                    {
                        <span class="badge bg-danger">En MantenciÃ³n</span>
                    }
                </td>
                <td>
                    @if (item.FechaUltimaMantencion.HasValue)
                    {
                        @item.FechaUltimaMantencion.Value.ToString("dd/MM/yyyy")
                    }
                    else
                    {
                        <span class="text-muted">Sin mantenciones</span>
                    }
                </td>
                <td>
                    @if (item.Activo)
                    {
                        <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info">Detalles</a>
                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-warning">Editar</a>
                        <a asp-action="CambiarEstado" asp-route-id="@item.Id" class="btn btn-sm btn-secondary">Estado</a>
                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger">Eliminar</a>
                    }
                    else
                    {
                        <form asp-action="Restaurar" asp-route-id="@item.Id" method="post" style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-success" onclick="return confirm('Â¿Restaurar esta camioneta?')">
                                â™»ï¸ Restaurar
                            </button>
                        </form>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

@if (!Model.Any())
{
    <div class="alert alert-info">
        @if (mostrarEliminadas)
        {
            <text>No hay camionetas eliminadas.</text>
        }
        else
        {
            <text>No hay camionetas registradas. <a asp-action="Create">Agregar la primera</a></text>
        }
    </div>
}